<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test QR Code - SmartLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .test-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
        }
        #qrcode {
            margin: 2rem 0;
            display: flex;
            justify-content: center;
        }
        .btn-test {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
        }
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-card">
        <h2><i class="fas fa-qrcode me-2"></i>Test QR Code SmartLink</h2>
        <p class="text-muted">Test de la fonctionnalité QR Code</p>
        
        <div id="status" class="status info">
            Prêt pour le test...
        </div>
        
        <div id="qrcode"></div>
        
        <div class="d-flex flex-wrap justify-content-center">
            <button class="btn btn-primary btn-test" onclick="testGenerateQR()">
                <i class="fas fa-plus me-1"></i>Générer QR Code
            </button>
            <button class="btn btn-success btn-test" onclick="testDownloadQR()">
                <i class="fas fa-download me-1"></i>Télécharger QR
            </button>
            <button class="btn btn-warning btn-test" onclick="clearQR()">
                <i class="fas fa-trash me-1"></i>Effacer
            </button>
        </div>
        
        <div class="mt-4">
            <small class="text-muted">
                <strong>URL testée :</strong> <span id="currentUrl"></span>
            </small>
        </div>
        
        <div class="mt-3">
            <a href="profile.html" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-1"></i>Retour au profil
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <script>
        // Afficher l'URL actuelle
        document.getElementById('currentUrl').textContent = window.location.href;
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function testGenerateQR() {
            updateStatus('Génération du QR Code...', 'info');
            
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            if (typeof QRCode === 'undefined') {
                updateStatus('❌ Erreur: Bibliothèque QRCode non chargée', 'error');
                return;
            }
            
            try {
                const url = window.location.href;
                QRCode.toCanvas(qrContainer, url, {
                    width: 200,
                    height: 200,
                    margin: 2,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    errorCorrectionLevel: 'M'
                }, (error) => {
                    if (error) {
                        updateStatus('❌ Erreur génération: ' + error.message, 'error');
                    } else {
                        updateStatus('✅ QR Code généré avec succès !', 'success');
                    }
                });
            } catch (error) {
                updateStatus('❌ Exception: ' + error.message, 'error');
            }
        }
        
        function testDownloadQR() {
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                updateStatus('❌ Aucun QR Code à télécharger', 'error');
                return;
            }
            
            try {
                const link = document.createElement('a');
                const timestamp = new Date().toISOString().slice(0, 10);
                link.download = `smartlink-qrcode-test-${timestamp}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                updateStatus('✅ QR Code téléchargé avec succès !', 'success');
            } catch (error) {
                updateStatus('❌ Erreur téléchargement: ' + error.message, 'error');
            }
        }
        
        function clearQR() {
            document.getElementById('qrcode').innerHTML = '';
            updateStatus('QR Code effacé', 'info');
        }
        
        // Test automatique au chargement
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('Page chargée - Prêt pour les tests', 'success');
            
            // Vérifier les dépendances
            setTimeout(() => {
                if (typeof QRCode !== 'undefined') {
                    updateStatus('✅ Bibliothèque QRCode chargée correctement', 'success');
                } else {
                    updateStatus('❌ Bibliothèque QRCode non disponible', 'error');
                }
            }, 1000);
        });
    </script>
</body>
</html>
