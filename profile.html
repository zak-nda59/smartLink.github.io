<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil - SmartLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark modern-nav">
        <div class="container">
            <a class="navbar-brand fw-bold brand-logo" href="index.html">
                <div class="brand-icon">
                    <i class="fas fa-link"></i>
                </div>
                SmartLink
            </a>
            <div class="navbar-nav ms-auto d-flex flex-row gap-2">
                <button class="btn btn-nav" id="editModeToggle">
                    <i class="fas fa-edit me-1"></i>
                    <span class="btn-text">Édition</span>
                </button>
                <button class="btn btn-nav" id="statsToggle">
                    <i class="fas fa-chart-line me-1"></i>
                    <span class="btn-text">Analytics</span>
                </button>
                <button class="btn btn-nav" id="exportData">
                    <i class="fas fa-share-alt me-1"></i>
                    <span class="btn-text">Partager</span>
                </button>
                <a href="qr-test.html" class="btn btn-nav" title="Test QR Code">
                    <i class="fas fa-bug me-1"></i>
                    <span class="btn-text">Test QR</span>
                </a>
                <div class="nav-divider"></div>
                <button class="btn btn-premium" id="qrToggle" data-bs-toggle="modal" data-bs-target="#qrModal">
                    <i class="fas fa-qrcode me-1"></i>
                    <span class="btn-text">QR Code</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Background -->
    <div class="profile-hero">
        <div class="hero-gradient"></div>
        <div class="hero-particles"></div>
    </div>

    <!-- Profile Container -->
    <div class="container profile-container">
        <div class="row justify-content-center">
            <!-- Profile Display -->
            <div class="col-lg-5" id="profileDisplay">
                <div class="modern-profile-card">
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-banner" id="profileBanner">
                            <div class="banner-overlay"></div>
                            <button class="banner-edit-btn floating-btn" id="editBanner" style="display: none;">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        
                        <!-- Profile Avatar -->
                        <div class="profile-avatar-section">
                            <div class="profile-avatar-container">
                                <img src="assets/images/default-avatar.svg" alt="Avatar" class="profile-avatar" id="profileAvatar">
                                <div class="avatar-ring"></div>
                                <button class="avatar-edit-btn floating-btn" id="editAvatar" style="display: none;">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                            
                            <!-- Profile Info -->
                            <div class="profile-info">
                                <h1 class="profile-name" id="profileName">@username</h1>
                                <p class="profile-bio" id="profileBio">Votre bio personnalisée</p>
                                
                                <!-- Profile Stats -->
                                <div class="profile-stats">
                                    <div class="stat-item">
                                        <span class="stat-number" id="totalClicks">0</span>
                                        <span class="stat-label">Clics</span>
                                    </div>
                                    <div class="stat-divider"></div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="totalLinks">0</span>
                                        <span class="stat-label">Liens</span>
                                    </div>
                                    <div class="stat-divider"></div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="profileViews">247</span>
                                        <span class="stat-label">Vues</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Links Container -->
                    <div class="modern-links-container" id="linksContainer">
                        <!-- Les liens seront ajoutés dynamiquement ici -->
                        <div class="empty-state" id="emptyState">
                            <div class="empty-icon">
                                <i class="fas fa-link"></i>
                            </div>
                            <h4>Aucun lien pour le moment</h4>
                            <p>Cliquez sur "Mode Édition" pour ajouter vos premiers liens</p>
                        </div>
                    </div>

                    <!-- Add Link Button (Edit Mode) -->
                    <button class="btn btn-add-link" id="addLinkBtn" style="display: none;">
                        <i class="fas fa-plus me-2"></i>
                        <span>Ajouter un lien</span>
                    </button>

                    <!-- Footer -->
                    <div class="profile-footer">
                        <div class="powered-by">
                            <span>Créé avec</span>
                            <strong>SmartLink</strong>
                            <i class="fas fa-heart text-danger"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Panel -->
            <div class="col-lg-8" id="editPanel" style="display: none;">
                <div class="edit-card">
                    <h3><i class="fas fa-cog me-2"></i>Personnaliser votre profil</h3>
                    
                    <!-- Profile Settings -->
                    <div class="edit-section">
                        <h5>Informations du profil</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Nom d'utilisateur</label>
                                <input type="text" class="form-control" id="editUsername" placeholder="@username">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Nom d'affichage</label>
                                <input type="text" class="form-control" id="editDisplayName" placeholder="Votre nom">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">Bio</label>
                            <textarea class="form-control" id="editBioText" rows="3" placeholder="Décrivez-vous en quelques mots..."></textarea>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Photo de profil (URL)</label>
                                <input type="url" class="form-control" id="editAvatarUrl" placeholder="https://...">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Bannière (URL)</label>
                                <input type="url" class="form-control" id="editBannerUrl" placeholder="https://...">
                            </div>
                        </div>
                    </div>

                    <!-- Theme Settings -->
                    <div class="edit-section">
                        <h5>Thème et couleurs</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Mode</label>
                                <select class="form-select" id="themeMode">
                                    <option value="light">Clair</option>
                                    <option value="dark">Sombre</option>
                                    <option value="auto">Automatique</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Couleur principale</label>
                                <input type="color" class="form-control form-control-color" id="primaryColor" value="#0d6efd">
                            </div>
                        </div>
                        <div class="theme-presets mt-3">
                            <label class="form-label">Thèmes prédéfinis</label>
                            <div class="theme-options">
                                <button class="theme-option" data-theme="default" style="background: linear-gradient(45deg, #0d6efd, #6610f2);">Défaut</button>
                                <button class="theme-option" data-theme="sunset" style="background: linear-gradient(45deg, #ff6b6b, #feca57);">Coucher</button>
                                <button class="theme-option" data-theme="ocean" style="background: linear-gradient(45deg, #74b9ff, #0984e3);">Océan</button>
                                <button class="theme-option" data-theme="forest" style="background: linear-gradient(45deg, #00b894, #00cec9);">Forêt</button>
                                <button class="theme-option" data-theme="purple" style="background: linear-gradient(45deg, #a29bfe, #6c5ce7);">Violet</button>
                            </div>
                        </div>
                    </div>

                    <!-- Link Management -->
                    <div class="edit-section">
                        <h5>Gestion des liens</h5>
                        <div id="editLinksContainer">
                            <!-- Les liens éditables seront ajoutés ici -->
                        </div>
                        <button class="btn btn-outline-primary" id="addNewLink">
                            <i class="fas fa-plus me-2"></i>Ajouter un nouveau lien
                        </button>
                    </div>

                    <!-- Save Button -->
                    <div class="text-end mt-4">
                        <button class="btn btn-success btn-lg" id="saveProfile">
                            <i class="fas fa-save me-2"></i>Sauvegarder les modifications
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Panel -->
            <div class="col-lg-8" id="statsPanel" style="display: none;">
                <div class="stats-card">
                    <h3><i class="fas fa-chart-line me-2"></i>Statistiques</h3>
                    
                    <div class="stats-overview">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="stat-box">
                                    <div class="stat-number" id="totalClicks">0</div>
                                    <div class="stat-label">Clics totaux</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-box">
                                    <div class="stat-number" id="totalLinks">0</div>
                                    <div class="stat-label">Liens actifs</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-box">
                                    <div class="stat-number" id="avgClicks">0</div>
                                    <div class="stat-label">Clics/lien</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-details">
                        <h5>Détails par lien</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Lien</th>
                                        <th>Clics</th>
                                        <th>Dernière visite</th>
                                    </tr>
                                </thead>
                                <tbody id="statsTable">
                                    <!-- Les statistiques seront ajoutées ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Edit Modal -->
    <div class="modal fade" id="linkEditModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modifier le lien</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="linkEditForm">
                        <div class="mb-3">
                            <label class="form-label">Titre du lien</label>
                            <input type="text" class="form-control" id="linkTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">URL</label>
                            <input type="url" class="form-control" id="linkUrl" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Type de lien</label>
                            <select class="form-select" id="linkType">
                                <option value="default">Lien standard</option>
                                <option value="social">Réseau social</option>
                                <option value="youtube">YouTube</option>
                                <option value="spotify">Spotify</option>
                                <option value="email">Email</option>
                                <option value="phone">Téléphone</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Icône (Font Awesome)</label>
                            <input type="text" class="form-control" id="linkIcon" placeholder="fas fa-globe">
                            <small class="form-text text-muted">Ex: fas fa-instagram, fab fa-youtube, fas fa-envelope</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Couleur personnalisée</label>
                            <input type="color" class="form-control form-control-color" id="linkColor">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="deleteLink">
                        <i class="fas fa-trash me-1"></i>Supprimer
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" id="saveLinkChanges">Sauvegarder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div class="modal fade" id="importExportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Import/Export des données</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h6>Exporter vos données</h6>
                        <p class="text-muted">Téléchargez un fichier JSON contenant tous vos liens et paramètres.</p>
                        <button class="btn btn-primary" id="downloadData">
                            <i class="fas fa-download me-2"></i>Télécharger JSON
                        </button>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <h6>Importer des données</h6>
                        <p class="text-muted">Restaurez vos données à partir d'un fichier JSON.</p>
                        <input type="file" class="form-control" id="importFile" accept=".json">
                        <button class="btn btn-success mt-2" id="importData" disabled>
                            <i class="fas fa-upload me-2"></i>Importer
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Code QR de votre profil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="qrcode"></div>
                    <p class="mt-3">Scannez ce code pour accéder à votre profil</p>
                    <div class="d-flex gap-2 justify-content-center">
                        <button class="btn btn-primary" id="downloadQR">
                            <i class="fas fa-download me-2"></i>Télécharger QR Code
                        </button>
                        <button class="btn btn-outline-secondary" onclick="testDownloadQR()">
                            <i class="fas fa-bug me-2"></i>Test Direct
                        </button>
                    </div>
                    <small class="text-muted d-block mt-2">
                        Si le téléchargement ne fonctionne pas, utilisez "Test Direct"
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggle Button -->
    <button id="themeToggle" class="theme-toggle" title="Basculer le thème">
        <i class="fas fa-moon"></i>
    </button>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Fonction de test direct pour le téléchargement QR
        function testDownloadQR() {
            console.log('=== TEST DIRECT TÉLÉCHARGEMENT QR ===');
            
            const canvas = document.querySelector('#qrcode canvas');
            console.log('Canvas trouvé:', !!canvas);
            
            if (canvas) {
                try {
                    console.log('Dimensions canvas:', canvas.width, 'x', canvas.height);
                    
                    // Test de conversion en data URL
                    const dataURL = canvas.toDataURL('image/png', 1.0);
                    console.log('Data URL généré:', dataURL.substring(0, 50) + '...');
                    
                    // Création du lien de téléchargement
                    const link = document.createElement('a');
                    link.download = 'smartlink-qr-test.png';
                    link.href = dataURL;
                    
                    // Ajout temporaire au DOM
                    document.body.appendChild(link);
                    console.log('Lien ajouté au DOM');
                    
                    // Déclenchement du téléchargement
                    link.click();
                    console.log('Clic déclenché');
                    
                    // Nettoyage
                    document.body.removeChild(link);
                    console.log('Lien supprimé du DOM');
                    
                    alert('✅ Test direct réussi ! Le fichier devrait être téléchargé.');
                    
                } catch (error) {
                    console.error('Erreur dans le test direct:', error);
                    alert('❌ Erreur dans le test direct: ' + error.message);
                }
            } else {
                alert('❌ Aucun QR Code trouvé. Veuillez d\'abord fermer et rouvrir le modal.');
            }
        }
    </script>
</body>
</html>
